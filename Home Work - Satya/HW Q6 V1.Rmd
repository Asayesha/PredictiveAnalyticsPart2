
OPENING THE FILE
```{r}
rm(list=ls())
setwd("D:/Summer Semester/Intro to Predictive Modelling/Unsupervised/data")
filename = 'groceries.txt'
groceries_raw = read.csv(filename, header = FALSE)

head(groceries_raw)
```

LOADING THE IMPORTANT LIBRARIES

```{r}
library(tidyverse)
library(arules)  # has a big ecosystem of packages built around it
library(arulesViz)

```


Getting the dataframe to the format required

```{r}
groceries_raw$basket = rownames(groceries_raw)


df1 =groceries_raw[,c(1,5)]
colnames(df1) <- c("items","basket")
df2 =groceries_raw[,c(2,5)]
colnames(df2) <- c("items","basket")
df3 =groceries_raw[,c(3,5)]
colnames(df3) <- c("items","basket")
df4 =groceries_raw[,c(4,5)]
colnames(df4) <- c("items","basket")


groceries <- rbind(df1,df2,df3,df4)
groceries = groceries[groceries$items != '',]
na.omit(groceries)
```


Top 20 items in any basket

```{r}
groceries$items %>%
  summary(., maxsum=Inf) %>%
  sort(., decreasing=TRUE) %>%
  head(., 20) %>%
  barplot(., las=2, cex.names=0.6,ylab="Frequency", main = 'Top 20 items by Frequency')
```


## Getting the variables into the transactions class

```{r}
groceries_new = split(x=groceries$items, f=groceries$basket)
groceries_new[[1]]
grocery_trans = as(groceries_new, "transactions")

```

## Getting all the rules with a support of .01 and confidence .05

```{r}
basketrules = apriori(grocery_trans, 
                     parameter=list(support=.005, confidence=.05))

arules::inspect(basketrules)

```

## Top 15 combinations of items which are usually bought together (Have high lift)

```{r}
arules::inspect(head(sort(basketrules, by = 'lift', decreasing = TRUE),15))
```

We see fruits mostly repeating. If people are buying one type of fruit, they most probably are going to buy other kinds of fruits as well. Hence it is a good idea to have all the fruits placed together


## What are people buying along with the rolls/buns:

Earlier we saw that rolls/buns are the second most frequently bought items. So now we are seeing what are people buying along with rolls/buns.

```{r}
rollsbuns_basket =  apriori (grocery_trans, parameter=list (supp=0.001,conf = 0.001,minlen = 2), appearance = list(default="lhs",rhs="rolls/buns"))

arules::inspect(head(sort(rollsbuns_basket, by = 'lift', decreasing = TRUE),15))

plot(head(rollsbuns_basket, n = 15, by = "lift"), method = 'graph', measure  = c("lift"))


```

We see that along with rolls/buns people tend to buy soda, sausages, cheeses more. So we should have the meat and cheeses sections close by the bakery section


## What are people buying the shopping bags for:

Earlier we saw that shopping bags are in the top 20 most frequently bought items. Let's checkout what these shoppig bags are for

```{r}
shoppingbags_basket =  apriori (grocery_trans, parameter=list (supp=0.001,conf = 0.001,minlen = 2), appearance = list(default="lhs",rhs="shopping bags"))

arules::inspect(head(sort(shoppingbags_basket, by = 'lift', decreasing = TRUE),15))

plot(head(shoppingbags_basket, n = 15, by = "lift"), method = 'graph', measure  = c("lift"))


```

People who buy cakes, hygiene articles, pot plants etc tend to buy shopping bags with them. Placing shopping bags along the aisles which have these items is recommended




## Exploring the baskets which has citrus fruits


```{r}
citrus_basket =  apriori (grocery_trans, parameter=list (supp=0.001,conf = 0.001,minlen = 2), appearance = list(default="lhs",rhs="citrus fruit"))

arules::inspect(head(sort(citrus_basket, by = 'lift', decreasing = TRUE),15))

plot(head(citrus_basket, n = 15, by = "lift"), method = 'graph', measure  = c("lift"))


```

We see that there are high chances of having beef/turkey with citrus fruits in the same basket. This is interesting, as citrus doesn't go well with either of those meets



Plotting the assosciation rules

```{r}


plot(basketrules, by = "lift", method = 'graph')


```


